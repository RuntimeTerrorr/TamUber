<% provide(:title, @user.firstname) %>
<div class="row" style = "margin:-20px">
  <aside class="col-md-4">
    <section class="user_info">
      <h2>
        <!--Weather Data in College Station-->
        <!--<%= gravatar_for @user %>-->
        <!--<%= @user.firstname %>-->
      </h2>
    </section>
  </aside>
</div>

<!DOCTYPE html>

<html>
  <head>
        

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    　　<meta name="viewport" content="width=device-width, initial-scale=1" />
　　<!--<link rel="stylesheet" type="text/css"-->
　　<!--　　media="screen and (max-device-width: 400px)"-->
　　<!--　　href="tinyScreen.css" />-->

    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <style>
          
      html, body {
        /*height: 100%;*/
        /*margin: 0;*/
        /*padding: 0;*/
        background-image: url(http://2.bp.blogspot.com/-OPYxCQCc4ao/UDBTISXA42I/AAAAAAAAAgk/smpKqpavnSs/s1600/tamu-1.jpg);
        background-size: cover;
      }

      h1
      {
          font-family: "Times New Roman";
          display: inline;
          color: black;
          font-weight: bold;
          text-align: left;
          font-size: 2.5em;   
      }
      h2,h3
      {
        font-family: "Times New Roman";
        background: #590000;
        color: white;
      }
      
      
      
      table, td, tr, th {
        /*border: 2px solid black;*/
        margin-top: 5px;
        text-align: left;
        vertical-align: center;
        padding: 5px
        /*font-size: 50px;*/
        font-family: "Times New Roman";
      }
      
      td{
        font-size: 14px;
      }

    @media screen and (min-width: 0px) and (max-width: 700px) {
      

      
      .top{
          width:100%;
          margin-top:140px;
      }
      .navbar, .navbar-fixed-top, .navbar-inverse{
        background-color:#500000;
        border-color:#500000;
        margin-bottom: 50px;
      }
      
      #dash {
        width:100%;
      }
      
      #weather{

        width:100%;
        margin-bottom: 10px;
      }
      
      #Em_contact{

          width:100%;
          margin-top:0px;
          padding-top:22px;
      }
      
      #EM-form {
        width:100%;
        margin-left:0px;
        margin-right:0px;
        padding-left:0px;
        padding-right:0px;
      }
      
      
      #ride {
        margin-top = 200px;
        padding = 10px;
        text-align: right;
        width:100%;
        position: relative;
      }
    }

    @media screen and (min-width: 701px) and (max-width: 3000px) {
  
       .top{
          margin-top:0px;
          padding-top:5px;
      }
      .navbar, .navbar-fixed-top, .navbar-inverse{
        background-color:#500000;
        border-color:#500000;
        margin-bottom:0px;
      }
      
      #dash {
        float: right;
        width:40%;
      }
      
      #weather{
        float: left; 
        width:40%;
        margin-bottom: 10px;
      }
      
      #Em_contact{
          float:left;
          margin-top:0px;
          padding-top:22px;
          
      }
      
      #contactform {
        float: left;
        width:40%;
      }
      
      #EM-form {
        width:100%;
        margin-left:0px;
        margin-right:0px;
        padding-left:0px;
        padding-right:0px;
        text-align:center;
      }
      
      #ride {
        margin-top = 200px;
        padding = 10px;
        text-align: right;
        float:right; width:40%;
        position: relative;
      }
}

    </style>
  </head>
  <body>

  <div class="top" align="center">
      <a style="width:100%" class="weatherwidget-io" href="https://forecast7.com/en/30d63n96d33/college-station/" data-label_1="COLLEGE STATION" data-label_2="WEATHER" data-theme="ruby" data-basecolor="#500000" >
        COLLEGE STATION WEATHER</a>    
  </div>

  <div id="weather">
    <h2> Weather Data for College Station </h2>
    <table class="table table-striped">
      <tr style = "background: white">
        <th>Temperature(Farenheit)</th>
        <td id="temperature"></td>
      </tr>
      <tr style = "background: white">
        <th>Humidity</th>
        <td id="humidity"></td>
      </tr>
      <tr style = "background: white">
        <th>Probability of Rain(%)</th>
        <td id="rain_prob"></td>
      </tr>
      <tr style = "background: white">
        <th>Intensity of Rain</th>
        <td id="rain_int"></td>
      </tr>
      <tr style = "background: white">
        <th>Visibility</th>
        <td id="visibility"></td>
      </tr>
      <tr style = "background: white">
        <th>WindSpeed</th>
        <td id="windSpeed"></td>
      </tr>
      <tr style = "background: white">
        <th>Summary</th>
        <td id="summary"></td>
      </tr>
    </table>
  </div>
    
    
  <div id="dash">
    <h2>Dashboard</h2>
    <table class="table table-striped" >

      <tr>
        <td> Since last update</td>
        <td id="time_diff" ><%=  @vehicle_stats['time']%></td>
      </tr>
      <tr style = "background: white">
        <td> Tire Pressure</td>
        <td id="tire_pressure" ><%= @vehicle_stats['tire_pressure']%></td>
      </tr>
      <tr style = "background: white">
        <td>Battery Level</td>
        <td id="battery_level"><%= @vehicle_stats['battery_level'] %></td>
      </tr>
      <tr style = "background: white">
        <td>Lidar Status</td>
        <td id="lidar_status"><%= @vehicle_stats['lidar_status'] %></td>
      </tr>
      <tr style = "background: white">
        <td>Occupancy</td>
        <td id="occupancy"><%= @vehicle_stats['occupancy'] %></td>
      </tr>
    </table>
  </div>
  


	  <div id="ride">
      <h2> Ride Information</h2>
      <table class="table table-striped">
        <tr>
          <td> Student Name</td>
          <td> Pickup </td>
          <td> Destination </td>
        </tr>
        
        <tr style = "background: white">
          <td> Alice </td>
          <td> ETB </td>
          <td> HRBB </td>
        </tr>
        <tr>
          <td> Bob </td>
          <td> MEOB </td>
          <td> MSC </td>
        </tr>
        <tr style = "background: white">
          <td> Mary </td>
          <td> WEB </td>
          <td> Evans </td>
        </tr>
      </table>
    </div>


    <div id="contactform">
      <h2> Contact Information</h2>
      <table class="table table-striped">
        <tr>
          <td> Administrative</td>
          <td> (979) 317-2000 </td>
        </tr>
        
        <tr style = "background: white">
          <td> UPD </td>
          <td> (979) 845-2345 </td>
        </tr>
      </table>
    </div>
</body>

	<script>
    !function(d,s,id)
    {
      var js,fjs=d.getElementsByTagName(s)[0];
      if(!d.getElementById(id))
        {js=d.createElement(s);js.id=id;js.src='https://weatherwidget.io/js/widget.min.js';
        fjs.parentNode.insertBefore(js,fjs);
          
        }
    }(document,'script','weatherwidget-io-js');
  </script>
  
  
  <script>
    // api key for darksky
    var apikey = "0abd0babd2f642553d1472379e791761";
    var lat = "30.617930";
    var long = "-96.337648";
    jQuery(document).ready(function(){
      weatherFunction();  // when the page has loaded, run weatherFunction
      update_values();
      // $('#weather_results').show();
    });
  
  
  function weatherFunction(){
    // Create a request variable and assign a new XMLHttpRequest object to it.
    var url1 = "https://api.darksky.net/forecast/";
    var html = '';
    var proxy = 'https://cors-anywhere.herokuapp.com/';
    var apiLinkDS = url1+apikey+"/"+lat+","+long;
    
    $.ajax({
      url: proxy + apiLinkDS,
      headers: {
          "Access-Control-Allow-Origin":"*"
      },
      success: function(data) {
        $('#temperature').html( data.currently.temperature );
        $('#humidity').html( data.currently.humidity );
        $('#rain_prob').html( data.currently.precipProbability * 100 );
        $('#rain_int').html( data.currently.precipIntensity );
        $('#visibility').html( data.currently.visibility );
        $('#windSpeed').html( data.currently.windSpeed );
        $('#summary').html(data.daily.summary );
      },
      error: function(e) {
        console.log(e);
      }
    });
    setTimeout(weatherFunction, 3600000);
  };

  function update_values(){
    $.ajax({
      type: "GET",
      url: "/dashboard",
      success: function (result) {
        console.log(result);
        $('#time_diff').html(result['time']); 
        $('#tire_pressure').html( result['tire_pressure']);
        $('#battery_level').html( result['battery_level']);
        $('#lidar_status').html( result['lidar_status']);
        $('#occupancy').html( result['occupancy']);
      },
      error: function(e) {
        console.log(e);
      }
     });
     setTimeout(update_values, 6000);
    };

  </script>
  <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
</html>